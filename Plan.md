# План автоматизации тестирования веб-сервиса покупки туров

## 1. Перечень автоматизируемых сценариев

### 1.1. UI-тесты (форма оплаты по карте / форма кредита)

| **Тестовый сценарий**                                                                                                                                                                      | **Ожидаемый результат**                                                          |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|
| **Позитивные сценарии:**                                                                                                                                                                   |                                                                                  |
| Успешная оплата APPROVED-картой с заполнением полей формы валидными значениями.<br/>(Например: `Номер карты: 1111 2222 3333 444, Месяц: 03, Год: 2027, Владелец: NIKOLAY FOMIN, CVC: 543`) | Платеж одобрен.                                                                  |
| Отказ в оплате DECLINED-картой с заполнением полей формы валидными значениями.<br/>(Например: `Номер карты: 5555 6666 7777 8888, Месяц: 01, Год: 2029, Владелец: FEDOR IVANOV, CVC: 223`)  | Платеж отклонен.                                                                 |
|                                                                                                                                                                                            |                                                                                  |
| **Негативные сценарии:**                                                                                                                                                                   |                                                                                  |
| **Пустые поля:**                                                                                                                                                                           |                                                                                  |
| Отправка формы с пустым полем "Номер карты".                                                                                                                                               | Сообщение об ошибке: `Поле обязательно для заполнения`.                          |
| Отправка формы с пустым полем "Месяц".                                                                                                                                                     | Сообщение об ошибке: `Поле обязательно для заполнения`.                          |
| Отправка формы с пустым полем "Год".                                                                                                                                                       | Сообщение об ошибке: `Поле обязательно для заполнения`.                          |
| Отправка формы с пустым полем "Владелец".                                                                                                                                                  | Сообщение об ошибке: `Поле обязательно для заполнения`.                          |
| Отправка формы с пустым полем "CVC/CVV".                                                                                                                                                   | Сообщение об ошибке: `Поле обязательно для заполнения`.                          |
|                                                                                                                                                                                            |                                                                                  |
| **Поле `"Номер карты"`:**                                                                                                                                                                   |                                                                                  |
| Ввод номера карты меньше необходимой длины (например, 15 цифр).                                                                                                                            | Сообщение об ошибке: `Неверный формат`.                                          |
| Ввод номера карты больше необходимой длины (например, 17 цифр).                                                                                                                            | Происходит ввод 16 символов, дальнейший ввод  не происходит                      |
| Ввод спецсимволов (например, `!@#`).                                                                                                                                                       | Ввод не происходит, поле остаётся пустым                                         |
| Ввод текстового значения (например, `abc`).                                                                                                                                                | Ввод не происходит, поле остаётся пустым                                         |
|                                                                                                                                                                                            |                                                                                  |
| **Поле `"Месяц"`:**                                                                                                                                                                         |                                                                                  |
| Ввод "0".                                                                                                                                                                                  | Сообщение об ошибке: `Неверный формат`.                                          |
| Ввод "1".                                                                                                                                                                                  | Сообщение об ошибке: `Неверный формат`                                           |
| Ввод "13".                                                                                                                                                                                 | Сообщение об ошибке: `Неверный формат`.                                          |
| Ввод спецсимволов (например, `*`).                                                                                                                                                         | Ввод не происходит, поле остаётся пустым                                         |
| Ввод текста на латинице (например, `Jan`).                                                                                                                                                 | Ввод не происходит, поле остаётся пустым                                         |
| Ввод текста на кириллице (например, `Янв`)                                                                                                                                                 | Ввод не происходит, поле остаётся пустым                                         |
|                                                                                                                                                                                            |                                                                                  |
| **Поле `"Год"`:**                                                                                                                                                                           |                                                                                  |
| Ввод "0".                                                                                                                                                                                  | Сообщение об ошибке: `Неверный формат`.                                          |
| Ввод "1".                                                                                                                                                                                  | Сообщение об ошибке: `Неверный формат`.                                          |
| Ввод спецсимволов (например, `?`).                                                                                                                                                         | Ввод не происходит, поле остаётся пустым                                         |
| Ввод текста на латинице (например, `Year`).                                                                                                                                                | Ввод не происходит, поле остаётся пустым                                         |
| Ввод текста на кириллице (например, `Год`)                                                                                                                                                 | Ввод не происходит, поле остаётся пустым                                         |
|                                                                                                                                                                                            |                                                                                  |
| **Совместная валидация `"Месяц"` и `"Год"`:**                                                                                                                                                  |                                                                                  |
| Ввод даты до текущего года <br/>(например, текущая дата — май 2025, ввод `02/2024`).                                                                                                       | Сообщение об ошибке:<br/> `Истёк срок действия карты` под полем "Год"            |
| Ввод даты до текущего месяца, но в текущем году <br/>(например, текущая дата — май 2025, ввод `04/2025`).                                                                                  | Сообщение об ошибке:<br/> `Неверно указан срок действия карты` под полем "Месяц" |
|                                                                                                                                                                                            |                                                                                  |
| **Поле `"Владелец"`:**                                                                                                                                                                       |                                                                                  |
| Ввод одной латинской буквы (например, `A`).                                                                                                                                                | Сообщение об ошибке: `Неверный формат`.                                          |
| Ввод более 30 латинских букв (например, `AlexanderAlexanderAlexander`).                                                                                                                    | Сообщение об ошибке: `Неверный формат`.                                          |
| Ввод на кириллице (например, `Иван Петров`).                                                                                                                                               | Сообщение об ошибке: `Неверный формат`.                                          |
| Ввод спецсимволов (например, `@!#`).                                                                                                                                                       | Сообщение об ошибке: `Неверный формат`.                                          |
| Ввод цифровых значений (например, `123`).                                                                                                                                                  | Сообщение об ошибке: `Неверный формат`.                                          |
|                                                                                                                                                                                            |                                                                                  |
| **Поле `"CVC/CVV"`:**                                                                                                                                                                        |                                                                                  |
| Ввод одной цифры (например, `1`).                                                                                                                                                          | Сообщение об ошибке: `Неверный формат`.                                          |
| Ввод двух цифр (например, `12`).                                                                                                                                                           | Сообщение об ошибке: `Неверный формат`.                                          |
| Ввод четырех цифр (например, `1234`).                                                                                                                                                      | Происходит ввод 16 символов, дальнейший ввод  не происходит                      |
| Ввод спецсимволов (например, `#`).                                                                                                                                                         | Ввод не происходит, поле остаётся пустым                                         |
| Ввод текста на латинице (например, `CCV`).                                                                                                                                                 | Ввод не происходит, поле остаётся пустым                                         |
| Ввод текста на кириллице (например, `ЦЦВ`)                                                                                                                                                 | Ввод не происходит, поле остаётся пустым                                         |
|                                                                                                                                                                                            |                                                                                  |
| Отправка формы с несуществующей картой (не `APPROVED`/`DECLINED`)                                                                                                                          | Платеж отклонен.                                                                 |

### 1.2. Тесты записи в СУБД
| **Тестовый сценарий**                                                                | **Ожидаемый результат**                       |
|--------------------------------------------------------------------------------------|-----------------------------------------------|
| **Позитивные сценарии:**                                                             |                                               |
| Успешная оплата APPROVED-картой с заполнением полей формы валидными значениями. | В СУБД в стобце `status` запись `APPROVED`    |
| Отказ в оплате DECLINED-картой с заполнением полей формы валидными значениями.  | В СУБД в стобце `status` запись `DECLINED` |
| Отправка формы с несуществующей картой (не `APPROVED`/`DECLINED`)                    | В СУБД в стобце `status` запись `DECLINED` |

### 1.3. API-тесты

| **Тестовый сценарий**                                                                                                                                                                           | **Ожидаемый результат**                                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|
| Тестирование ендпоинта `/api/v1/pay`                                                                                                                                                            |                                                                                      |
| Успешная оплата APPROVED-картой с заполнением полей формы валидными значениями.<br/> Например `POST {number: "1111 2222 3333 444", year: "27", month: "04", holder: "IVAN PETROV", cvc: "214"}` | Код ответа сервера: `200`:<br/> Тело ответа `{"status":"APPROVED}`                   |
| Отказ в оплате DECLINED-картой с заполнением полей формы валидными значениями.<br/>Например `POST {number: "5555 6666 7777 8888", year: "29", month: "01", holder: "ARTEM ZDANOV", cvc: "119"}` | Код ответа сервера: `200`:<br/> Тело ответа `{"status":"DECLINED}`                   |
| Отправка формы с несуществующей картой (не `APPROVED`/`DECLINED`)<br/>Например `POST {number: "2202 3456 7890 1234", year: "26", month: "08", holder: "ARTUR PIROZKOV", cvc: "244"}`            | Код ответа сервера: `500`:<br/> Тело ответа содержит `"message": "400 Bad Request",` |

## 2. Перечень инструментов с обоснованием

| Инструмент        | Назначение                       | Обоснование                                                           |
|-------------------|----------------------------------|-----------------------------------------------------------------------|
| **Selenium**      | UI-автоматизация                 | Поддержка браузеров, удобство интеграции с Java                       |
| **JUnit5**        | Фреймворк для тестов             | Гибкость, поддержка параметризованных тестов                          |
| **RestAssured**   | API-тестирование                 | Удобство работы с HTTP-запросами                                      |
| **Faker**         | Генерация тестовых данных        | Генерация случайных тестовых данных для избегания эффекта "Пестицида" |
| **Lombok**        | Автоматическая генерация методов | Сокращение кода, удобство использования                               |
| **Gson**          | Работа с API                     | Упрощения работы с API, сокращение лишнего кода                       |
| **Allure Report** | Отчётность                       | Визуализация результатов                                              |
| **Docker**        | Развёртывание БД                 | Изоляция тестовой среды (MySQL)                                       |
| **Gradle**        | Сборка проекта                   | Управление зависимостями, запуск тестов                               |
| **Appveyor**      | CI                               | Автоматический прогон тестов                                          |

## 3. Возможные риски

1. **Нестабильность UI-тестов** - из-за задержек рендеринга
2. **Проблемы с доступом к внешнему сервису (Payment/Credit Gate)** - общий сервис может быть перегружен/недоступен
3. **Ошибки в конфигурации БД** - некорректные настройки `application.properties`
4. **Изменение структуры формы** - тесты потребуют доработки
5. **Ограниченные тестовые данные** - только 2 карты (`APPROVED`/`DECLINED`)

## 4. Оценка времени с учётом рисков

| Этап                | Оптимистично (ч) | Пессимистично (ч) | Итог (ч) |
|---------------------|------------------|-------------------|----------|
| Настройка окружения | 4                | 8                 | 6        |
| Написание UI-тестов | 12               | 20                | 16       |
| Проверка СУБД       | 6                | 10                | 8        |
| Интеграция Allure   | 2                | 4                 | 3        |
| Отчётность          | 4                | 8                 | 6        |
| **Итого**           | **28**           | **50**            | **39**   |

## 5. План сдачи работ

| Этап                     | Срок (дни) | Результат                                   |
|--------------------------|------------|---------------------------------------------|
| Настройка среды и БД     | 1-2        | Готовность Docker + SUT + тестовой БД       |
| Реализация UI-тестов     | 3-5        | Автотесты для одной формы                   |
| Проверка СУБД + отчёты   | 6          | Allure-отчёт + проверка записей в БД        |
| Финализация документации | 7          | `Plan.md`, `Report.md`, `Summary.md`        |
| Сдача проекта            | 8          | Публикация репозитория с тестами и отчётами |


